---
import { getCollection } from "astro:content";
import Layout from "../../layouts/SiteBaseLayout.astro";
import { sort } from "../../lib/sort";

export async function getStaticPaths() {
  const collection = await getCollection("article");
  const tags = [
    "all",
    ...[...new Set(collection.flatMap((post) => post.data.tags))].sort(),
  ];

  return [
    ...tags.map((tag) => ({
      params: { path: tag },
    })),
    { params: { path: undefined } },
  ];
}

const { path } = Astro.params;

const posts = sort(await getCollection("article"));
const tags = [
  "all",
  ...[...new Set(posts.flatMap((post) => post.data.tags))].sort(),
];
const articles = !path
  ? posts
  : posts.filter((post) => post.data.tags?.includes(path));

const image = Astro.url.origin + "/assets/og/default.webp";
---

<Layout title="articles" description="all articles" image={image}>
  <main class="text-text">
    <section class="px-6 lg:px-10">
      <div
        class="grid grid-cols-2 md:grid-cols-12 max-w-5xl mx-auto min-h-screen h-max text-base">
        <div class="md:col-span-3 border-border border-l border-r">
          <div class="mt-20">
            <h2 class="pl-4 pb-2 border-b border-border">filter by tag</h2>
            <ul class="flex flex-col gap-1.5 mt-2 pl-4">
              {
                tags.map((tag) => (
                  <li class="flex w-full">
                    <a
                      class="w-full hover:opacity-50"
                      href={`/articles/${tag === "all" ? "" : tag}`}>
                      {tag}
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>
        </div>

        <div class="md:col-span-7 h-full">
          <div class="mt-45">
            <h1 class="pl-4 pb-2 border-b border-border">Articles</h1>
            <ul class="flex flex-col gap-1.5 mt-2 pl-4">
              {
                articles.map((article) => (
                  <li class="flex w-full">
                    <a
                      class="w-full hover:opacity-50"
                      href={`/articles/${article.id}`}>
                      {article.data.title}
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>
        </div>

        <div
          class="hidden md:flex md:justify-between md:flex-col md:col-span-2 border-border border-l border-r h-full">
          <div></div>
        </div>
      </div>
    </section>
  </main>
</Layout>
